# AIサーバとモデルルータに関する哲学・提案書

**日付**: 2026-01-29  
**ステータス**: 提案  
**作成者**: AI Assistant

---

## 1. ビジョンと哲学

本提案は、単なるLLMのAPI利用を超え、**「AIサーバ」**という概念を再定義し、UI操作と対話履歴を**「資産」**として蓄積するシステムを構想するものです。

### 1.1 AIサーバと「アドレス」の価値
AIサーバは、単なるバックエンド処理装置ではなく、固有の**「アドレス」**を持つ存在として扱います。
- **アドレスの等価性**: APIエンドポイント（URL）は、メールアドレスや物理的な住所と同様に、リソースへのアクセス権とアイデンティティを表します。
- **一貫したインターフェース**: ユーザーは「アドレス」に対してリクエストを送ることで、テキスト生成（LLM）、画像生成（SD）、画像認識（VLM）などの機能にアクセスします。これにより、バックエンドの複雑さを隠蔽し、統一的な対話体験を提供します。

### 1.2 UIとプロンプト履歴の「資産化」
従来のチャットインターフェースでは、履歴は「流れ去るログ」として扱われがちでした。本提案では、これを**「資産（Asset）」**として再定義します。
- **再利用可能な知識**: 過去のプロンプトと生成結果のペアは、将来のファインチューニングデータセットや、Few-shotプロンプティングの例として直接利用可能な形式で保存します。
- **UI状態の保存**: テキストだけでなく、その時のUIの状態（パラメータ設定、レイアウトなど）も履歴の一部として保存し、いつでもその「瞬間」を再現可能にします。

### 1.3 タイムベース（時間軸）アプローチ
全てのデータとインタラクションを**「時間（Time）」**を主軸に整理します。
- **文脈の進化**: 時間経過に伴う文脈の変化を可視化し、任意の時点の状態へ「タイムトラベル」できるようにします。
- **非同期の価値**: 即時応答だけでなく、時間をかけた生成や処理（バッチ処理、長考推論）も、タイムライン上のイベントとして自然に統合します。

### 1.4 遅い対話（Slow Dialogue）の復権
現在のLLM対話は即時応答（リアルタイム性）が重視されすぎており、ユーザーがAIのペースに巻き込まれ、深く思考する時間を奪われているという課題があります。本システムはこの現状を打破します。
- **思考のための媒体としてのMAIL**: 機能としての「Slow Mode」ではなく、本質的に非同期である**「メール（MAIL）」**を対話の主戦場とすることで、自然と熟考する時間を確保します。
- **「急かされない」体験**: チャットの「入力中...」のプレッシャーや即時応答の呪縛から解放されます。メールというフォーマット自体が、数時間〜数日かけて推敲し、深い洞察を含んだ往復書簡（Letter）のような対話を可能にします。
- **「待つ」ことの価値化**: AIがバックグラウンドで長時間の推論（Deep Research / Reasoning）を行う時間を可視化し、待つことが「放置」ではなく「より良い結果のための投資」であると定義します。

---

## 2. アーキテクチャ概要

### 2.1 全体構成図

```
[ユーザー/クライアント]
       │
       │ (リクエスト: テキスト/画像/音声)
       ▼
┌─────────────────────────────────────┐
│             AIサーバ (Gateway)      │
│  [ アドレス: https://ai.local/v1 ]   │
└──────────────────┬──────────────────┘
                   │
           ┌───────┴───────┐
           ▼               ▼
┌──────────────────┐   ┌──────────────────┐
│   モデルルータ    │←──┤  コンテキスト管理  │
│  (Model Router)  │   │ (Time-based DB)  │
└─────────┬────────┘   └──────────────────┘
          │
          ├─── [ LLM (Ollama/vLLM) ] ─── テキスト生成・論理推論
          │
          ├─── [ VLM (Llava/BakLLaVA) ] ── 画像認識・マルチモーダル理解
          │
          ├─── [ SD (Stable Diffusion) ] ── 画像生成
          │
          └─── [ Audio (Whisper/TTS) ] ── 音声処理
```

### 2.2 モデルルータ (Model Router)
多様なモデル（LLM, SD, VLM）へのリクエストを振り分ける中核コンポーネントです。
- **インテリジェント・ルーティング**: ユーザーの入力意図（Intent）を解析し、適切なモデルを自動選択します。
    - *「猫の画像を描いて」* → Stable Diffusionへルーティング
    - *「この画像の看板の文字を読んで」* → VLMへルーティング
    - *「メールの返信を書いて」* → LLMへルーティング
- **統合API**: クライアント側はモデルごとのAPI差分を意識せず、統一されたフォーマットでリクエスト可能です。

### 2.3 資産管理システム (Asset Manager)
履歴を資産化するためのデータベースおよび管理システムです。
- **構造化ログ**: プロンプト、パラメータ（Seed, CFG Scale, Temperature等）、出力結果をJSON形式などで構造化して保存。
- **タイムラインUI**: 過去の履歴を時系列で閲覧し、過去の成功した生成パラメータをワンクリックで再利用（Fork）できるインターフェースを提供。

---

## 3. 具体的なユースケース

### ケース1: クリエイティブ制作の資産化
ユーザーが画像生成を行う際、試行錯誤の過程（プロンプトの調整、Seed値の変更）が全て記録されます。
- **価値**: 最終成果物だけでなく、「どのようにその画像を作ったか」というプロセス自体が資産となり、チーム内で共有したり、自動生成のテンプレートとして再利用可能になります。

### ケース2: マルチモーダル・メールエージェント
メールクライアント（Thunderbird等）からの入力をAIサーバが受け取ります。
- **動作**: 添付画像がある場合はVLMで内容を解析し、その結果をコンテキストとしてLLMが返信案を作成します。
- **統合**: 全ての処理は「AIサーバのアドレス」へのリクエストとして完結します。

---

## 4. 実装へのロードマップ

### Phase 1: モデルルータの基盤構築
- Python (FastAPI) を用いたゲートウェイサーバの実装
- Ollama (LLM) と Stable Diffusion WebUI API (SD) への接続
- 基本的なルーティングロジック（キーワードベース）の実装

### Phase 2: 資産化データベースの実装
- SQLite/PostgreSQLを用いた対話履歴の構造化保存
- プロンプト、生成パラメータ、タイムスタンプの記録
- 履歴検索APIの実装

### Phase 3: タイムベースUIと高度なルーティング
- 履歴をタイムライン表示するWeb UI / ダッシュボード
- VLMの統合と、画像入力に基づくルーティング
- 小規模LLMを用いた意図判定ルーティングの導入

---

## 5. 結論
本提案は、AIモデルを単なるツールとしてではなく、組織や個人の「知的資産」を生み出し続けるパートナーとして位置づけます。モデルルータによる柔軟な拡張性と、履歴の資産化による継続的な価値向上により、長期的に運用可能なAI基盤を構築します。
